# 06-1. RAM의 특징과 종류

- 메모리는 일반적으로 RAM을 말한다

## RAM의 특징

- 전원을 끄면 RAM은 기억을 잃는다
  - `휘발성 저장 장치`다
  - `비휘발성 저장 장치`는?
    - 보조기억장치(하드디스크, SSD, USB 등..)
    - `보관할 대상`을 저장한다
- 휘발성 저장 장치이기 때문에 컴퓨터가 켜져있는 동안 RAM을 활용한다
  - `실행할 대상`을 저장한다
- CPU는 보조기억장치에는 접근하지 못하고, 실행할 대상을 가진 RAM에는 접근이 가능하다

## RAM의 용량과 성능

- 보조기억장치에 있는 프로그램을 실행하고 싶은데, RAM의 용량이 작다면?
  - 하나 들고왔다가 다시 빼고 다시 그 다음거 들고왔다가 다시 빼고… → 여러번 움직이기 때문에 느리다
- RAM의 용량이 클 수록 여러 프로그램을 많이 가져와서 실행할 수 있다
- 하지만 용량이 크다고 무조건 더더더~ 빨라지는건 절대 아니다
  - 책 1000권을 넣을 수 있을 만큼 충분히 여유있는 공간에 10권를 가져오는 것과 100권를 가져오는 것은 동일한 속도이기 때문

## RAM의 종류

### DRAM : Dynamic RAM

- 일반적으로 사용하는 RAM
- 일정 시간이 지나면 데이터가 동적으로 변한다, 사라진다
- 데이터 소멸을 막으려면 계속적으로 데이터를 재활성화 시켜줘야 한다
- 장점
  - 소비 전력이 비교적 낮다
  - 저렴하다
  - 집적도가 높다
    - 더 작고 빽빽한 설계가 가능하다 → 대용량 설계가 용이하다

### SRAM : Static RAM

- DRAM과 달리 데이터가 변동되지 않는다
- DRAM보다 속도는 빠르다
- DRAM에 비해 가성비가 좋지 않기 때문에 대용량으로 만들 수 없지만 속도가 빨라야하는 저장 장치로 쓰인다
  - 그것이 바로 캐시 메모리
    - 캐시는 직접 제거해줘야되지 않는가..

### SDRAM : Synchronous Dynamic RAM

- 클럭 타이밍에 맞춰 CPU와 정보를 주고 받는다
- DRAM의 진화 버전

### DDR SDRAM : Double Data Rate SDRAM

- 최근 가장 흔히 사용된다
- 대역폭을 넓혀 속도를 빠르게 했다
  - 데이터를 주고 받는 길의 넓이를 늘렸다. SDRAM보다 Double로..
  - CPU와 더 많은 데이터를 주고 받을 수 있다
- 최근 가장 흔히 사용되는 메모리는 DDR4 SCRAM이다
  - 무려 16배 넓은 대역폭을 가진다..

# 06-2. 메모리의 주소 공간

- 물리 주소는 메모리 하드웨어가 사용하는 주소
- 논리 주소는 CPU와 실행 중인 프로그램이 사용하는 주소

## 물리 주소와 논리 주소

- 프로그램이 실행되어 메모리에 저장되면 같은 주소에 적재될 수 없다
- 물리 주소는 늘 변하기 때문에 CPU나 실행 중인 프로그램은 메모리에 어떤 주소로 저장되어 있는지 다 알 수 없다
- CPU와 실행 중인 프로그램은 물리 주소대신 논리 주소를 이용한다
- 메모리는 물리 주소, CPU와 실행 중인 프로그램은 논리 주소를 사용한다면 둘 간의 상호작용은 어떻게 일어날까?
  - 각 주소 간의 변환은 CPU와 주소 버스 사이에 있는 `메모리 관리 장치(MMU, Memory Management Unit)`이라는 하드웨어에 의해 일어난다
- CPU의 논리 주소에 베이스 레지스터 값을 더해서 물리 주소로 변환한다
  - 베이스 레지스터는 프로그램의 첫 물리 주소를 저장한다 (가장 작은 물리 주소) → 기준이 되어 논리 주소에서 물리 주소로 변환이 가능하다

## 메모리 보호 기법

- CPU가 논리 주소를 기준으로 물리 주소에 접근하는 명령어는 위험하다
  - 예를 들어,, `인터넷 브라우저 1100번지 데이터를 삭제하라!` 라는 명령어는 물리 주소에서 1100번지가 인터넷 브라우저의 영역일지 아닐지는 장담하지 못한다
- 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호하는 일을 하는 것은 `한계 레지스터`이다
- 베이스 레지스터는 프로그램의 가장 작은 물리 주소를 저장하고, 한계 레지스터는 논리 주소의 최대 크기를 저장한다
- 프로그램의 베이스 레지스터 값과 한계 레지스터 값은 프로그램의 물리 주소 최대 범위가 될 것이다
- 실행 중인 프로그램이 한계 레지스터를 벗어난 값에 접근하려고 하면 `인터럽트(트랩)`을 발생시켜 실행을 중단한다

# 06-3. 캐시 메모리

## 저장 장치 계층 구조

- 저장 장치가 속도가 빠르고, 용량이 크면 좋겠지만 둘 다 공존하기는 어렵다
  - CPU와 가까우면 빠르고, 멀면 느리다
  - 속도가 빠르면 저장 용량이 작고, 가격이 비싸진다
- 저장 장치는 CPU를 기준으로 얼마나 가까운가에 따라 계층적 구조를 가질 수 있는데 그것을 `저장 장치 계층 구조(memory hierarchy)` 라고 한다
  - 레지스터 > 메모리 > 보조기억장치
    - 왼쪽 기준으로 속도가 빠르고 용량이 작고 비싸다

## 캐시 메모리

- CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고, 메모리 보다 빠른 SRAM 기반의 저장 장치이다
- CPU의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위해 나타났다
  - 메모리에서 사용될 데이터를 캐시 메모리에 미리 가져와서 활용한다
- 저장 장치 계층 구조에서 캐시 메모리의 위치는 아래와 같다
  - 레지스터 > 캐시 메모리 > 메모리 > 보조기억장치
- 캐시 메모리도 여러 개가 있고, 계층 구조를 만들 수 있는데 CPU와 가장 가까운 캐시 메모리를 L1(level 1) 캐시 그 이후로 L2 캐시와 L3 캐시가 있다
  - 계층 구조를 가진 만큼 필요한 데이터를 L1 캐시부터 순차적으로 검색해 나간다
  - L1 캐시와 L2 캐시는 코어마다 각자 가지고 있고, L3 캐시는 여러 코어가 공유하는 형태이다
    - L1 캐시를 L1D로 분리하여 사용할 수 있는데 이는 `분리형 캐시`라고 한다

## 참조 지역성 원리

- 보조 기억 장치는 컴퓨터의 전원 상태와 상관없이 프로그램을 저장하고, 메모리는 실행 중인 프로그램을 저장한다면 캐시 메모리는 무엇을 저장할까?
  - 캐시 메모리는 CPU가 활용할 법한 대상을 예측하여 저장한다
  - 이 예측이 들어 맞으면 `캐시 히트`라고 한다
  - 하지만 들어 맞지 않으면 `캐시 미스` 라고 하고, 캐시 미스가 자주 발생하면 CPU가 메모리에 접근하는 횟수가 많아지므로 성능이 저하된다
- 이런 캐시 히트가 되는 비율을 `캐시 적중률` 이라 하고, 우리가 일반적으로 사용하는 컴퓨터의 캐시 적중률은 85~95%이다
- 캐시 메모리는 CPU가 사용할 만한 데이터를 어떻게 예측할까?
  - 이는 참조 지역성의 원리를 바탕으로 사용될 데이터를 결정한다
- 참조 지역성의 원리
  - CPU는 최근 접근했던 메모리 공간에 다시 접근하려는 경향이 있다
  - CPU는 접근한 메모리 공간 근처에 접근하려는 경향이 있다

### 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다

- 처음 변수를 저장하고 나면 저장된 변수를 사용할 수 있다
- 그렇기 때문에 언제든지 CPU가 해당 변수를 다시 참조할 수 있다는 것을 예측할 수 있다
  - = 해당 변수가 저장된 메모리 공간에 다시 접근한다
- 이런 경향을 `시간 지역성` 이라 한다

### 접근한 메모리 공간 근처를 접근하려는 경향이 있다

- 프로그램은 보통 관련 데이터끼리 한데 모여 저장되어 있다
- 어떤 한 프로그램의 자동 저장 기능, 입력 기능, 출력 기능은 한데 모여 저장된다
- 어떤 프로그램이 실행되면 CPU가 그 근처를 집중적으로 접근할 것을 예측할 수 있다
- 이런 경향을 `공간 지역성` 이라 한다
