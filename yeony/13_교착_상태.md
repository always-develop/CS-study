# 13-1. 교착 상태란

- 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상
- 2개 이상의 프로세스가 서로의 자원을 사용하기 위해 계속 기다리는 현상..
  - 결국 2개 이상의 프로세스들은 기다리기만 할 수 밖에 없는 상황

## 자원 할당 그래프

- 프로세스가 어떤 자원을 사용하고 있는지, 어떤 자원을 기다리는지 나타내는 그래프이다
- 자원 할당 그래프의 규칙
  - 프로세스는 원, 자원은 사각형으로 표현
  - 사용할 수 있는 자원의 개수는 사각형 내 점으로 표현
  - 프로세스가 어떤 자원을 받아 사용 중이라면 `자원의 점 → 프로세스` 화살표 표시
  - 프로세스가 어떤 자원을 기다리고 있다면 `프로세스 → 자원의 점` 화살표 표시
- 그래프로 표현하면 현재 일어나는 상황이 교착 상태인 것을 한 눈에 알아보기 쉽다

## 교착 상태 발생 조건

- 교착 상태가 발생하는 조건은 4가지 이다

**상호 배제**
하나의 프로세스가 자원을 사용 중일 때, 다른 자원이 사용하지 못하는 상호 배제 상황

**점유와 대기**
자원을 이미 할당 받은 상태에서 다른 자원을 기다리는 상태

**비선점**
다른 프로세스가 사용 중인 자원을 강제로 빼앗지 못하는 상태

**원형 대기**
자원 할당 그래프가 원의 형태를 띄며 자원을 대기하는 상태, = 원형 대기
`교착 상태의 자원 할당 그래프는 원의 형태를 띈다` → 역은 성립하지 않는다

# 13-2. 교착 상태 해결 방법

## 교착 상태 예방

- 앞서 나온 교착 상태 발생 조건 중 하나를 충족하지 못하게 하자

### 상호 배제 예방

- 모든 자원을 공유 가능하게 만든다는 것은 현실적으로 어렵다..

### 점유와 대기 예방

- 특정 프로세스에 자원을 모두 할당하고, 어떤 프로세스에는 자원을 아예 할당하지 않는 방식
- 자원을 몰아주는 방법이기 때문에 효율이 좋지 않다
- 자원을 많이 사용하는 프로세스는 자원을 사용할 타이밍을 잡기 어렵다 → 기아 현상 발생!

### 비선점 조건 예방

- CPU는 이 방법으로 실행된다
  - 우선순위에 따라 큐의 새치기가 가능한 방식!
- 하지만 무조건 현재 프로세스를 끝내고, 다음 프로세스를 실행해야하는 자원에서는 실현되기 어렵다

### 원형 대기 조건 예방

- 모든 자원에 번호를 붙이고, 순서대로 자원을 사용하게 한다
- 하지만 원으로 배치되어 있으면 마지막 프로세스는 자원을 사용하지 못하므로 형태를 일렬로 배치하면 모두 한꺼번에 자원을 사용할 수 있다
- 하지만 모든 자원에 번호를 붙이는 건 쉽지 않다.. 효율이 떨어질 수도 있다..

**교착 상태를 일으키는 조건을 아예 제거하면 교착 상태는 발생하지 않을 수 있지만 효율이 떨어질 수 있고, 범용적이게 활용될 수 있는 것은 아니다**

## 교착 상태 회피

- 발생 조건을 제거하기 보다 교착 상태가 일어나지 않을 만큼 자원을 할당한다
- 교착 상태가 일어나지 않을 만큼만 자원을 프로세스에게 할당한다
- 교착 상태에 대한 용어
  - 안정 상태 : 교착 상태가 발생하지 않고, 모든 프로세스가 정상적으로 자원을 할당 받을 수 있는 상태
  - 불안정 상태 : 교착 상태가 발생할 수 있는 상태
  - 안전 순서열 : 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
- 안전 순서열이 있어야 안정 상태를 유지할 수 있다

**운영체제가 교착 상태에 빠지지 않기 위해서는 `안정 상태 → 안정 상태` 로 자원을 움직여야한다**

## 교착 상태 검출 후 회복

- 교착 상태가 이미 발생 했고, 사후에 조치하는 방법은?

**선점을 통한 회복**
교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식이며 해결될 때까지 강제로 자원을 빼앗아 프로세스에게 할당한다

**프로세스 강제 종료를 통한 회복**
모든 프로세스를 강제로 종료한다.. → 작업 내역을 잃을 가능성이 있다.
하나씩 프로세스를 강제로 종료한다.. → 교착 상태가 없어졌는지 여부를 확인하는 과정에 오버헤드 발생 가능성이 있다

- 타조 알고리즘?
  - 잠재적인 교착 상태를 무시하는 방법..
  - 아주 무책임해보이지만 이 알고리즘이 적합한 상황이 있다고 한다
