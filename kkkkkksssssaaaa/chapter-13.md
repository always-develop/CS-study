# 13장. 교착 상태

# [CS] 👽 혼자 공부하는 컴퓨터구조+운영체제

---

## 13장. 교착 상태

### 13-1. 교착 상태란

- 다수의 프로세스가 특정 자원을 사용하기 위해 무한 대기에 빠지며 아무 것도 할 수 없는 현상을 `교착 상태(Dead lock)` 라고 한다
- 뮤텍스 락에서도 교착 상태가 발생할 수 있다
  - 프로세스A가 공유 자원a 를 잠그고
  - 프로세스B가 공유 자원b 를 잠근 상황에서
  - A가 사용하려는 자원이 b 고 B가 사용하려는 자원이 a라면 교착 상태가 일어난다
- `자원 할당 그래프(Resource-allocation graph)` 란
  - 어떤 프로세스가 어떤 자원을 사용하고 있는지, 어떤 자원을 기다리고 있는지를 간단히 표현한 그래프라고 한다
  - 여튼, 교착 상태가 발생한다면 그래프가 원 형태를 띄게 된다(식사하는 철학자를 떠올리자)
- 교착 상태는 아래의 네 가지가 충족되면 발생한다
  - 상호 배제
    - 사용하려는 자원이 누군가가 사용 중이라 사용할 수 없을 때
  - 점유와 대기
    - 다른 자원을 보유한 채 다른 자원을 기다리고 있을 때
  - 비선점
    - 다른 프로세스의 작업이 끝날 때 까지 자원을 강제로 뺏어올 수 없을 때
  - 원형 대기
    - 프로세스가 요청-할당 받은 자원이 원형을 띌 때

### 13-2. 교착 상태 해결 방법

- 교착 상태 발생 요건 네 가지 조건 중 하나를 충족하지 못하게 한다면 교착 상태는 발생하지 않는다
- 교착 상태 예방 방법
  - 상호 배제 현상을 없앤다는 것은, 모든 자원이 공유 가능하게 한다는 것이므로 이는 현실적이지는 않다..
  - 점유 대기를 없애려면, 프로세스가 자원을 모두 가지고 있거나, 자원을 아예 할당하지 않으면 되나…… 이 방법도 굉장히 비효율적이다
  - 비선점 조건을 없앤다면.. 선점 가능한 자원인 경우 굉장히 효과적이나, 범용성이 떨어지는 방법이라고 한다
  - 원형 대기 조건을 없애는게 가장 간단하다
    - 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당한다고 한다
    - 식사하는 철학자 문제에서 원형 식탁이 아닌, 일자 식탁을 두는 것이다
- 교착 상태 회피 방법
  - 프로세스들이 적은 자원만을 요구한다면 교착 상태가 발생하기 힘들다
  - `안전 상태(Safe state)` 란 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당 받고 종료될 수 있는 상태를 말한다
    - 안전 상태에는 `안전 순서열(Safe sequence)` 이 존재한다
    - 교착 상태 없이 안전하게 프로세스에게 자원을 할당할 수 있는 순서를 의미한다고 한다
  - 반대로 교착 상태가 발생할 수 있는 상황을 `불안전 상태(Unsafe state)` 라고 한다
  - 결국, 교착 상태를 회피 하려면 안전 상태를 유지하도록 자원을 할당할 수 있어야 한다
- 교착 상태 검출 후 회복
  - 교착 상태가 해결될 때 까지 한 프로세스씩 자원을 몰아주는 방식도 있다고 한다
    - 이를 `선점을 통한 회복` 이라고 한다
  - `프로세스 강제 종료` 를 통한 방법도 있다
    - 가장 확실하다
    - 신뢰와 전통의 해결 방법이다
- 타조 알고리즘이라는 아주 귀여운 이름의 알고리즘도 있는데, 교착 상태를 무시하는 방법이라고 한다…
