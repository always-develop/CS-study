# 06. 메모리와 캐시 메모리

# [CS] 👽 혼자 공부하는 컴퓨터구조+운영체제

---

## 06. 메모리와 캐시 메모리

### 06-1. RAM 의 특징과 종류

- 컴퓨터의 전원이 꺼지면 저장한 데이터가 사라지는 저장 장치를 `휘발성 저장 장치(volatile memory)`, 전원이 꺼져도 데이터가 보존되는 저장 장치를 `비휘발성 저장 장치(non-volatile memory)` 라고 한다
- CPU 는 보조기억장치에 직접 접근하지 못한다
  - 그래서 휘발성 저장 장치인 RAM 에는 실행할 대상을, 비휘발성 저장 장치인 보조기억장치에는 보관할 대상을 저장한다
  - 보조기억장치에 저장된, 보관할 대상 `프로그램` 이 실행되는 시점에 RAM 으로 복사하하여 저장한 뒤 실행한다
- RAM 용량이 크면 이득이긴 하지만, 결국 CPU 가 RAM 에 접근하는 시간과 RAM 이 보조기억장치의 데이터를 불러오는 시간이 존재하기 때문에, RAM 용량과 컴퓨터의 속도는 비례하지는 않는다
- RAM 의 종류
  - `DRAM(Dymanic RAM)`
    - 저장된 데이터가 동적으로 변하는(사라지는) RAM 이라고 한다
      - 그래서 오랫동안 저장해야하는 데이터라면 데이터를 다시 저장해줘야 한다고 한다
    - 보통 DRAM 을 사용한다
    - 가성비가 좋다!
  - `SRAM(Static RAM)`
    - 저장된 데이터가 변하지 않는 RAM 이라고 한다
    - 가성비는 좋지 않다!
      - 다만 속도가 더 빠르기 때문에 캐시 메모리에 주로 사용된다고 한다
    - SRAM 도 전원이 공급되지 않으면 휘발된다
  - `SDRAM(Synchronous Dynamic RAM)`
    - static dynamic 이 아니다 ㅋㅋ
    - 클럭 신호와 동기화 된, 발전된 형태의 DRAM 이라고 한다
      - 클럭 타이밍에 맞추어 CPU 와 정보를 주고받을 수 있음을 의미한다
  - `DDR SDRAM(Double Data Rate SDRAM)`
    - 오늘날 가장 많이 사용되는 RAM
    - 대역폭을 넓혀 속도를 빠르게 만든 SDRAM 이당
      - 대역폭이란, 데이터를 주고받는 길의 너비를 의미한다
    - 한 클럭당 하나씩 데이터를 주고받을 수 있는 SDRAM 을 `SDR SDRAM(Single Data Rate SDRAM)` 이라고 한다
    - 이 SDR SDRAM 에 대비하여 대역폭이 몇 배나 넓은지에 따라 `DDR(n) SDRAM` 이라고 한다
      - 만약, DDR2 라면 DDR 의 두 배이기 때문에 SDR 보다 네 배 넓다
      - DDR3 이라면 DDR2 의 두 배이기 때문에 SDR 보다 여덟 배 넓다
      - DDR4 는 DDR3 대비 두 배이기 때문에 SDR 대비 열여섯 배 넓다

### 06-2. 메모리의 주소 공간

- 사실 메모리 주소는 두 종류가 존재한다
  - `물리 주소` 는 메모리 하드웨어가 사용하는 주소이며
    - 데이터가 실제 물리적으로 저장된 주소를 의미한다
  - `논리 주소` 는 CPU 와 실행 중은 프로그램이 사용하는 주소이다
    - 실행 중인 프로그램에게 부여된, 0번지부터 시작되는 주소를 의미한다
- 메모리에 저장된 정보는 시시각각 변하기 때문에… CPU 와 실행 중인 프로그램은 메모리 몇 번지에 어떤 데이터가 있는지 정확히 전부 다 알지 못한다고 한다
- 논리 주소만 가지고는 물리 주소에 접근할 수는 없는데, 이 때 `메모리 관리 장치(Memory Management Unit, MMU)` 라는 녀석이 이 주소간의 변환을 담당해준다고 한다
  - MMU 는 CPU 와 주소 버스 사이에 위치한 하드웨어라고 한다
  - MMU 는 논리 주소와 베이스 레지스터의 값을 참고하여 물리 주소를 알아낼 수 있다고 하는데, 베이스 레지스터란 프로그램의 첫 물리 주소를 저장하는 공간이다
- 다만, 물리 주소를 계산하다가 실수로 다른 프로그램의 메모리 영역으로 침범할 수도 있는데… 이 때 메모리 영역을 보호하기 위하여 `한계 레지스터(Limit Register)` 라는 녀석이 메모리 영역을 보호하는 역할을 한다고 한다
  - 베이스 레지스터와 완전 반대로, 프로그램의 마지막 논리 주소를 저장한다고 한다
  - 베이스 레지스터와 한계 레지스터 덕분에 첫 번째 물리 주소와 마지막 논리 주소 범위를 계산할 수 있게 되어 다른 프로그램의 메모리 영역을 보호할 수 있게 된다
  - 그래서 CPU 가 메모리에 접근할 때에는 프로그램의 메모리 영역을 계산하여 접근할 수 있는 메모리 주소인지 판단 후에 접근한다고 한다
    - 만약, 영역을 벗어난 주소에 접근하려 한다면 인터럽트(트랩)를 발생시켜 실행을 중단한다

### 06-3. 캐시 메모리

- 빠른 속도와 저장 용량은 양립하기 어렵다
  - 속도가 빠른 저장 장치는 저장 용량이 작고 비싸며, 속도가 느린 저장 장치는 용량이 크고 저렴하다
- CPU 에 얼마나 더 가까이 위치하는지에 따라 저장 장치를 계층 구조로 나타낼 수 있다
- CPU 가 메모리에 접근하는 것은 느리기 때문에, CPU 와 메모리 사이에 `캐시 메모리` 라는 것을 두게 되었다
  - 캐시 메모리는 SRAM 기반의 저장장치이다
- 캐시 메모리도 여러 종류가 있는데, CPU 와 가까운 순으로 L1, L2, L3 캐시로 나뉜다
  - L1, L2 는 각 코어마다 존재하며, L3 는 여러 코어가 공유하는 형태로 존재한다
  - 여기서 더… L1 캐시는 명령어만 저장하는 `L1I` 캐시, 데이터만 저장하는 캐시인 `L1D` 캐시로도 나뉘는데, 이를 `분리형 캐시` 라고 한다
- 메모리가 보조기억장치의 데이터를 일부 복사하여 들고있는 것 처럼, 캐시 메모리도 메모리의 일부를 복사해서 가지고 있는다
- 캐시 메모리에 저장되는 대상은… CPU 가 자주 사용할 것으로 예측한 데이터를 저장한다
  - 만약 저장한 데이터를 실제로 CPU 가 사용하게 되는 경우를 `캐시 히트(cache hit)` 라고 한다
  - 반대로, 캐시에 저장된 데이터를 CPU 가 활용하지 않고 메모리로 직접 가져와 사용하게 되는 경우를 `캐시 미스(cache miss)` 라고 한다
  - 캐시 히트 비율을 `캐시 적중률(cache hit ratio)` 이라고 부르는데, 캐시 적중률을 계산하는 공식은 아래와 같다
    - `캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)`
  - 보편적인 컴퓨터의 캐시 적중률은 대략 85~95% 이상이라고 한다 ㅎㄷㄷ
- 캐시 메모리가 자주 사용하는 데이터를 예측하기 위해 `참조 지역성의 원리(Locality of reference, Principle of locality)` 를 이용한다
  - CPU 가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어진 원리라고 한다
    - CPU 는 최근 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
      - 즉, 한 번 참조한 데이터는 계속해서 참조할 수 있다는 뜻이다
      - 프로그래밍으로 본다면, 한 번 선언한 변수는 프로그램이 실행되는 동안 여러 번 사용된다는 뜻
      - 이를 `시간 지역성(Temporal locality)` 이라고 한다
    - CPU 는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.
      - 프로그램의 데이터는 보통 한 곳에 모여있기 마련…
      - 그리고 프로그램 내에서도 관련이 있는 데이터들은 모여서 저장된다
      - 그렇기 때문에, CPU 는 명령을 실행할 프로그램이 모여있는 공간을 접근할 것이고, 사용자의 행동에 따른 데이터들이 모여있는 공간에 집중적으로 접근할 것이다
      - 이를 `공간 지역성(Spatial locality)` 라고 한다
