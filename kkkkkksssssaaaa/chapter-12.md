# 12장. 프로세스 동기화

# [CS] 👽 혼자 공부하는 컴퓨터구조+운영체제

---

## 12장. 프로세스 동기화

### 12-1. 동기화란

- 운영체제의 프로세스 관리 중 가장 중요한 두 가지를 꼽자면 스케줄링과 동기화가 있다
- 프로세스들은 동시다발적으로 수행될 수 있다
  - 이들은 서로 데이터를 주고받으며 협력할 수 있다
  - 협력 관계에 있는 프로세스들이 마구잡이로 실행되서는 안되기 때문에, `동기화` 가 필수로 이루어져야 한다
    - 동기화란? 정보통신 분야에서는 작업들 사이의 `수행 시기` 를 맞추는 것을 의미한다
      - 수행 시기란? 프로세스를 올바른 순서로 실행하는 `실행 순서 제어` 와 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하는 `상호 배제` 가 있다
- 실행 순서 제어를 위한 동기화
  - 특정 파일에 대한 읽기-쓰기 프로세스가 존재할 때, 쓰기 작업이 일어나기 전에 읽기 작업이 먼저 수행 되면 안된다
  - 위와 같은 경우, 쓰기 작업이 일어난 후 읽기 작업이 수행될 수 있도록 실행 순서를 보장해주는 작업이 실행 순서 제어를 위한 동기화 작업이다
- 상호 배제를 위한 동기화
  - 공유 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘이다
  - 특정 프로세스가 공유 불가능한 자원에 대한 작업을 진행 중일 때에는 다른 프로세스가 해당 자원에 접근하지 못하게 하는 것이다
  - 트랜잭션, 뮤텍스, 세마포어, CAS 연산, 락 등등이 상호 배제를 위한 동기화 작업을 수행하는 작업의 종류이다
- 상호 배제를 위한 동기화 작업에서 가장 유명하고 고전적인 문제로는 `생산자와 소비자 문제` 가 있다
  - 간단히 요약하면 데이터를 생산하기만 하는 `생산자` 와 데이터를 소비하기만 하는 `소비자` 가 존재하는 경우, 해당 데이터에 대한 접근이 동시에 이루어지면 안된다는 것이다
  - 이 때, 생산자가 생산하는 데이터와 소비자가 소비하는 데이터는 같다
  - 이를 `공유 자원(Shared resource)` 이라고 한다
  - 공유 자원은 전역 변수, 파일, 기억장치 등등 공유 가능한 자원이면 무엇이든 될 수 있다
  - 실제 코드에서는, 공유 자원을 다룰 때에는 `임계 영역(Critical section)` 을 지정하여 동기화를 수행한다
    - 한 프로세스(혹은 스레드)가 임계 영역에 진입했다면 다른 프로세스는 진입할 수 없으며, 먼저 임계 영역에 진입한 프로세스의 작업이 끝날 때 까지 대기해야 한다
    - 하지만, 잘못된 실행으로 인해 여러 프로세스가 임계 영역에 진입할 수 있다
    - 이러한 현상을 `레이스 컨디션(Race condition)` 이라고 한다
    - 레이스 컨디션이 발생하면 동기화 되어야 하는 데이터에 대해 일관성이 깨지는 대참사가 발생한다
- 운영체제가 임계 영역을 보장하는 원칙들
  - `상호 배제(Mutual exclusion)`
    - 한 프로세스가 임계 영역에 접근했다면 다른 프로세스가 접근할 수 없도록 해야 한다
  - `진행(Progress)`
    - 임계 영역에 접근한 프로세스가 없다면, 임계 영역에 접근하려는 프로세스가 접근할 수 있도록 해야한다
  - `유한 대기(Bounded waiting)`
    - 임계 영역에 접근한 프로세스가 존재하는 상황에서, 다른 프로세스가 임계 영역에 접근하려 한다면 언젠가는 임계 영역에 접근할 수 있어야 한다

### 12-2. 동기화 기법

- `뮤텍스(Mutex)`
  - 프로세스가 임계 구역에 진입 했음을 알리기 위해 자원의 잠금 여부를 알려주는 기법
    - 잠금 여부를 판단하기 위해 `boolean 전역 변수` 를 사용한다
    - 잠그는 역할을 하는 함수는 `acquire()` 이라는 함수가 담당한다
    - 잠금을 해제하는 역할은 `relase()` 함수가 담당한다
  - 다만, 자원이 잠겨있는지 확인하기 위해 쉴 새 없이 반복하며 잠금 여부를 확인해야 한다
  - 이런 대기 방식을 `바쁜 대기(Busy wait)` 라고 한다
- `세마포어(Semaphore)`
  - 뮤텍스 락보다 조금 더 일반화된 방식의 동기화 도구이다
  - 단 한 개의 프로세스만 접근 가능한 구조인 뮤텍스와는 달리, 세마포어는 여러 개의 프로세스가 공유 자원에 접근할 수 있을 때 사용한다
    - `사용 가능한 공유 자원의 수를 나타내는 전역 변수` 를 사용한다
    - 임계 영역에 접근해야하는지, 대기해야하는지를 알려주는 `wait()` 함수가 존재한다
    - 대기 중인 프로세스에게 임계 영역에 접근 가능함을 알려주는 `signal()` 함수가 존재한다
  - 뮤텍스와 마찬가지로 바쁜 대기 현상이 발생할 수 있지만, 대기 큐를 사용하여 바쁜 대기 현상을 해소할 수 있다
    - 임계 영역에 접근하기 위해 대기 상태에 있는 프로세스를 세마포어 대기 큐에 넣고
    - 임계 영역에 접근한 프로세스가 작업 종료 후 signal() 함수를 호출하면
    - 대기 큐에 있는 프로세스를 준비 상태로 변경 후 준비 큐에 넣어준다
- `모니터(Monitor)`
  - 세마포어도 아주 훌륭한 동기화 도구지만, 임계 영역 앞 뒤로 일일이 wait() 과 signal() 을 명시해야 하는 번거로움이 있다
  - 모니터는 공유 자원과 공유 자원에 접근하기 위한 인터페이스를 묶어서 관리하는 동기화 도구라고 한다
    - 즉, 프로세스가 자원 자체에 접근하는 것이 아니라, 자원에 접근하기 위해 특정한 인터페이스를 통해서만 접근 하는 방식이다
    - 어떻게 보면 공유 자원에 대한 캡슐화를 한 것이라고 할 수 있겠다..
  - 모니터도 실행 순서 제어를 위한 특별한 변수를 사용하는데, 이를 `조건 변수(Condition variable)` 라고 한다
    - 조건 변수로 wait(), signal() 연산을 수행할 수 있다
  - 모니터에 접근하기 위한 큐와 모니터에 이미 진입했지만 잠시 실행이 중단되어 대기 중인 큐가 별도로 존재하니 주의하라고 한다
