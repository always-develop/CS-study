# 08. 입출력장치

# [CS] 👽 혼자 공부하는 컴퓨터구조+운영체제

---

## 08. 입출력장치

### 08-1. 장치 컨트롤러와 장치 드라이버

- 전송률(transfer rate)이란
  - 데이터를 얼마나 빨리 교환할 수 있는지를 나타내는 지표
- CPU 나 메모리와는 달리, 입출력장치의 데이터 전송률은 낮다고 한다
  - 장치에 따라 CPU 나 메모리보다 전송률이 높은 경우도 있지만, 보통 입출력장치와 CPU/메모리의 전송률이 비슷하지 않기 때문에, 각 장치간의 통신이 어려워진다고 한다
  - 그래서 `장치 컨트롤러` 라고 하는 하드웨어가 입출력장치 ↔ CPU/메모리간의 통신을 중개해준다고 한다
  - 장치 컨트롤러는 각기 다른 입출력장치들의 데이터들을 CPU 가 해석할 수 있도록 번역기 역할을 해준다고 한다
- 장치 컨트롤러는 입출력 제어기(I/O Controller), 입출력 모듈(I/O Module) 등으로 불리운다고 한다
- 장치 컨트롤러가 데이터 전송률을 맞추기 위해 `버퍼(Buffer)` 라는 임시 저장 공간에 데이터를 저장하여 전송률을 비슷하게 맞춘다고 한다
  - 이를… 버퍼링이라고 한다…..!
- 장치 컨트롤러의 내부는 복잡하지만, 간략하게 따져서 아래의 레지스터를 가지고 있다고 한다
  - 데이터 레지스터
    - CPU 와 입출력장치가 주고 받을 데이터가 담긴다
      - 즉, 버퍼 역할을 수행한다
  - 상태 레지스터
    - 입출력장치의 상태를 체크한다
  - 제어 레지스터
    - 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장한다
- 장치 드라이버란 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램이라고 한다
  - 장치 컨트롤러는 하드웨어적인 통로라면, 장치 드라이버는 소프트웨어적 통로이다
- 장치 드라이버는 규격화된 인터페이스가 존재하기 때문에.. 규격을 맞춘다면 어떤 회사에서 만들어지든, 어떤 제품이던간에 사용 가능하다
  - 장치 드라이버의 실행 주체는 운영체제이다

### 08-2. 다양한 입출력 방법

- 장치 컨트롤러가 정보를 주고받는 방법은 크게 세 가지가 있다
- `프로그램 입출력(Programmed I/O)`
  - 프로그램 속 명령어로 입출력 장치를 제어한다
  - CPU 가 프로그램의 명령어를 수행하다가 입출력 명령어를 만나게 되면 장치 컨트롤러를 통해 입출력장치와 상호작용한다
  - 하지만 CPU 가 모든 장치 컨트롤러의 레지스터를 알 수는 없다..
  - 이를 위해, 크게 두 가지 방식의 레지스터 식별 방식이 존재한다
    - `메모리 맵 입출력` 이란 메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법이다
      - 입출력장치의 레지스터도 일반적인 메모리 주소 공간으로 사용한다는 뜻이다
      - 그래서 CPU 가 메모리 주소를 대하는 방식과 똑같이 입출력장치의 레지스터에 접근할 수 있다고 한다
    - `고립형 입출력` 이란 메모리 맵 입출력과는 반대로, 메모리 주소 공간과 입출력장치의 주소 공간을 분리하는 방법이다
      - 제어 버스의 명령어가 입출력장치 I/O 인지, 메모리 I/O 명령인지에 따라 CPU 가 수행하는 명령어가 달라진다는 차이가 있다
- `인터럽트 기반 입출력`
  - 사실, 입출력장치의 하드웨어 인터럽트는 장치 컨트롤러에 의해 발생한다
    - 입출력장치와 CPU 는 직접 통신하지 않는다
  - 인터럽트를 기반으로 하는 입출력 방식을 통해 CPU 는 Non-Blocking 하게 동작할 수 있게 된다
    - 반대로, CPU 가 주기적으로 장치 컨트롤러에게 입출력 장치의 상태를 확인하는 것을 `폴링(Polling)` 이라고 한다
    - 당연히 CPU 의 부담이 더 큰 것은 폴링 방식이다
  - 인터럽트가 동시에 발생했을 때, 우선순위를 고려하여 처리할 수 있다고 한다
    - 이를 처리하기 위해 보통은 프로그래머블 `인터럽트 컨트롤러(Programmable Interrupt Controller, PIC)` 라는 하드웨어를 사용한다
    - 여러 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청들의 우선순위를 판별하여 지금 처리할 인터럽트가 무엇인지 CPU 에게 알려주는 역할을 수행한다고 한다
- `DMA(Direct Memory Access) 입출력`
  - 위의 두 가지 방식은 모든 입출력장치의 데이터는 CPU 를 거친다는 공통점이 있다
  - DMA 방식은 이름에서 알 수 있다시피 CPU 를 거치지 않고 직접 메모리에 접근할 수 있는 입출력 기능이다
  - 시스템 버스에 DMA 컨트롤러라는 하드웨어가 필요하다고 한다
    - 이 녀석이 장치 컨트롤러와 상호작용한다
    - 인터럽트도 이 녀석이 건다
      - 즉, CPU 는 이 녀석과 소통한다
  - 다만, 시스템 버스는 동시에 사용이 불가능하며 공용 자원이기 때문에, CPU 가 사용하지 않을 때에만 사용 가능하거나, 아예 시스템 버스를 점유해야한다는 단점이 있다
    - 그래서, DMA 가 시스템 버스에 연결되는 것이 아니라, 입출력 버스라는 별도의 버스에만 연결되는 것으로 위 단점을 해소할 수 있다고 한다
    - 현대의 대부분의 컴퓨터에는 입출력 버스가 별도로 존재한다고 한다
